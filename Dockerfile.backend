FROM golang:1.21

RUN apt-get update && apt-get install -y \
    libpcap-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY filter.go .

RUN go mod init filter
RUN go get github.com/gin-gonic/gin \
    github.com/google/gopacket \
    github.com/google/gopacket/pcap \
    github.com/gorilla/websocket
RUN go build -o filter filter.go

RUN mkdir -p /etc/filter /var/log
RUN touch /var/log/filter.log /app/traffic.log
RUN chmod 644 /var/log/filter.log /app/traffic.log

CMD ["./filter"]
